<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ILS">
<title>Univariate Data Analysis • ILS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Univariate Data Analysis">
<meta property="og:description" content="ILS">
<meta property="og:image" content="https://mflores72000.github.io/ILS/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ILS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/Authors.html">
    <span class="fa fa-user"></span>
     
    Authors
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions and Databases</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-materials">Materials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-materials">
    <a class="dropdown-item" href="../articles/InterlaboratoryStudies.html">Example ILS</a>
    <a class="dropdown-item" href="../articles/univariantes.html">Univariate Data Analysis</a>
    <a class="dropdown-item" href="../articles/FDA.html">Functional Data Analysis (FDA)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-scientific-articles">Scientific Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-scientific-articles">
    <a class="dropdown-item" href="../articles/Articles.html">Articles</a>
    <a class="dropdown-item" href="../articles/Thesis.html">Thesis</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-conferences">Conferences</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-conferences">
    <a class="dropdown-item" href="../articles/conference_videos.html">Conference Videos</a>
    <a class="dropdown-item" href="../articles/conference_materials.html">Conference Materials</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mflores72000/ILS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Univariate Data Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mflores72000/ILS/blob/HEAD/vignettes/univariantes.Rmd" class="external-link"><code>vignettes/univariantes.Rmd</code></a></small>
      <div class="d-none name"><code>univariantes.Rmd</code></div>
    </div>

    
    
<p><br></p>
<div class="section level2">
<h2 id="standard-approach">
<span style="color: #1CA666;">2. Standard Approach</span><a class="anchor" aria-label="anchor" href="#standard-approach"></a>
</h2>
<p style="text-align:justify;">
The ILS package provides two groups of functions made to detect outlying individual results (outlying replicates) and outlying laboratories: both for the scalar and the functional cases (Table 1). The ILS package offers graphical and analytical procedures (statistical hypothesis test) for this purpose.
</p>
<p><br></p>
<center>
<strong>Table 1</strong>: Functions incorporated to the ILS package to perform Interlaboratory Studies with a scalar and functional approach.
</center>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left"><strong>Technique</strong></th>
<th align="left"><strong>Function</strong></th>
<th align="left"><strong>Description</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Scalar</strong></td>
<td align="left">Plot</td>
<td align="left"><code>h.qcs, k.qcs</code></td>
<td align="left">Mander’s <span class="math inline">\(h\)</span> and <span class="math inline">\(k\)</span> statistics</td>
</tr>
<tr class="even">
<td align="left"><strong>approach</strong></td>
<td align="left">Test</td>
<td align="left"><code>test.cochran</code></td>
<td align="left">Cochran test</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"><code>test.grubbs</code></td>
<td align="left">Grubbs test</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"><code>lab.aov</code></td>
<td align="left">ANOVA</td>
</tr>
<tr class="odd">
<td align="left"><strong>Funtional</strong></td>
<td align="left">Plot</td>
<td align="left"><code>h.fqcs, k.fqcs</code></td>
<td align="left">Mandel’s <span class="math inline">\(H(x)\)</span> y <span class="math inline">\(K(x)\)</span> functional statistics</td>
</tr>
<tr class="even">
<td align="left"><strong>approach</strong></td>
<td align="left">Test</td>
<td align="left"><code>mandel.fqcs</code></td>
<td align="left">Mandel’s functional test</td>
</tr>
</tbody>
</table>
<p><br></p>
<p style="text-align:justify;">
As above mentioned, among the methodologies used to evaluate the consistency of laboratory results, we must highlight the r&amp;R studies, which quantify the variability between laboratories (reproducibility) and variability between results (repeatability). The repeatability is the variability between the results of the independent tests obtained for each individual laboratory, i.e. the evaluation of the variability produced by the measurement system since the results are obtained by a single operator in each laboratory and in a short interval of time. On the other hand, the reproducibility refers to the variability between the re- sults of individual tests obtained in different laboratories, allowing to determine the bias.
</p>
<p><br></p>
<p style="text-align:justify;">
Accordingly with the repeatability and reproducibility concepts, Mandel’s <span class="math inline">\(h\)</span> and <span class="math inline">\(k\)</span> statistics are used in ILS to detect laboratories that provide inconsistent results. The h statistic explains the variability between the laboratories, that is, estimates the bias, which is the difference of the means of each laboratory with respect to the global mean, while the k statistic estimates the variability within the laboratories, comparing the repeatability corresponding to each laboratory. The decision rule for detecting whether a laboratory is inconsistent is based on the comparison between the value of the <span class="math inline">\(h\)</span> or <span class="math inline">\(k\)</span> statistic and the critical value calculated with a significance level of <span class="math inline">\(0.5%\)</span>, which is the one recommended by ASTM E-691.
</p>
<br><p style="text-align:justify;">
On the other hand, the <code>ILS</code> package performs the Cochran test to examine the consistency within a laboratory, whereas the Grubbs test is commonly used to examine consistency between laboratories. The Grubbs test can also be used as a consistency test for the results obtained in a laboratory using identical materials. These tests are recommended by ISO 5725-2.
</p>
<p><br></p>
<div class="section level3">
<h3 id="consistency-tests">
<span style="color: #1CA666;">2.1. Consistency tests</span><a class="anchor" aria-label="anchor" href="#consistency-tests"></a>
</h3>
<p style="text-align:justify;">
The basic statistical model proposed on ISO 5725-2 that estimate the accuracy and precision of an analytical method is:
</p>
<p><span class="math display">\[\begin{equation}
 y = m + B + \epsilon  (1)
\end{equation}\]</span></p>
<p style="text-align:justify;">
Where <span class="math inline">\(m\)</span> is the general mean for the material under analysis, <span class="math inline">\(B\)</span> is the laboratory bias component under repeatability conditions, and <span class="math inline">\(\epsilon\)</span> is the random error occurring in each measure under repeatability conditions. The repeatability variance <span class="math inline">\(\sigma_r^2\)</span> is estimated by <span class="math inline">\(S_r^2\)</span>, which is the within-laboratory variance. On the other hand, the between-laboratory variance <span class="math inline">\(\sigma_B^2\)</span> is estimated by <span class="math inline">\(S_B^2\)</span>, this variance is related to laboratory bias. The reproducibility variance <span class="math inline">\(\sigma_r^2\)</span> is given by:
</p>
<p><span class="math display">\[\begin{equation}
\sigma_R^2=\sigma_r^2+\sigma_B^2 
\end{equation}\]</span></p>
<p><br></p>
<p style="text-align:justify;">
Using the <code>ILS</code> package, one-way ANOVA analysis and mean comparison test can be performed. However, laboratories that present non-consistent results should be excluded from the ILS in advance. Accordingly, consistency tests and identidication of atypical results must be performed in advance of ANOVA analysis.
</p>
<p><br></p>
<center>
<strong>Table 2</strong>: ANOVA approach for the estimation of <span class="math inline">\(S_r^2\)</span> and <span class="math inline">\(S_B^2\)</span>.
</center>
<table style="width:100%;" class="table">
<colgroup>
<col width="26%">
<col width="57%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left"><strong>Source</strong></th>
<th align="left"><strong>Mean squares</strong></th>
<th align="left"><strong>Estimate of</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Laboratory</td>
<td align="left"><span class="math inline">\(MS_B=\frac{\displaystyle\sum_{i=1}^L n_i(\bar{y}_i-(\bar{y})^2)}{(L-1)}, \hspace{0.1cm}S_B^2=\frac{MS_B-MS_r}{\bar{n}}\)</span></td>
<td align="left"><span class="math inline">\(\sigma_r^2+\bar{n}\sigma_B^2\)</span></td>
</tr>
<tr class="even">
<td align="left">Residual = repeatibility</td>
<td align="left"><span class="math inline">\(MS_r=\frac{\displaystyle\sum_{i=1}^L\displaystyle\sum_{j=1}^{n_i} (y_{ij}-\bar{y}_i)}{(N-L)}, \hspace{0.1cm}d.f.=(N-L)\)</span></td>
<td align="left"><span class="math inline">\(\sigma_r^2\)</span></td>
</tr>
</tbody>
</table>
<p>In Table(2), the one-way ANOVA approach results are shown, with</p>
<p><span class="math display">\[\begin{equation}
  \bar{n}=\frac{1}{L-1}\left(\displaystyle\sum_{i=1}^L n_i-\frac{\displaystyle\sum_{i=1}^L n_i^2}{\displaystyle\sum_{i=1}^L n_i}\right), \hspace{0.1cm} \mbox{and} \hspace{0.1cm}N=\displaystyle\sum_{i=1}^L n_i. \hspace{0.1cm}\mbox{If}\hspace{0.1cm}S_B^2\leq 0, \mbox{set}\hspace{0.1cm}S_B^2=0 
\end{equation}\]</span></p>
<p style="text-align:justify;">
There are two possible scenarios in which the presence of outliers can be evaluated: the first is that the results of one laboratory deviates from the others in terms of precision, that is, when the measurements made by a laboratory differ signficantly with respect to the measurements obtained by other laboratories. The second scenario is related with the identification of outliers in a laboratory for a certain level. The statistics and tests recommended by ISO 5725-2 and ASTM E-691 are described below.
</p>
<p><br></p>
<div class="section level4">
<h4 id="mandels-h-statistic-and-grubbs-test">
<span style="color: #1CA666;">2.1.1. Mandel’s h statistic and Grubbs test</span><a class="anchor" aria-label="anchor" href="#mandels-h-statistic-and-grubbs-test"></a>
</h4>
<p style="text-align:justify;">
Let <span class="math inline">\((x_1, x_2,\ldots, x_L)\)</span> a sample of <span class="math inline">\(L\)</span> observations. The <span class="math inline">\(x_l; l = 1, \ldots,L\)</span> are modelled as realizations of random variables <span class="math inline">\(X_l; l = 1, \ldots,L\)</span> being identically and independently distributed according to the normal distribution <span class="math inline">\(N(\mu, \sigma^2)\)</span>. We denote:
</p>
<p><span class="math display">\[\begin{equation}
\bar{X}=\frac{\displaystyle\sum_{l=1}^L X_l}{L} 
\end{equation}\]</span></p>
<p style="text-align:justify;">
as the mean of the <span class="math inline">\(X_l\)</span>,
</p>
<p><span class="math display">\[\begin{equation}
 S^2=\frac{1}{L-1}\displaystyle\sum_{l=1}^L (X_l-\bar{X})^2 
\end{equation}\]</span></p>
<p style="text-align:justify;">
as the sample variance of the <span class="math inline">\(X_l\)</span>.
</p>
<p style="text-align:justify;">
Mandel’s h statistic is defined by:
</p>
<p><span class="math display">\[\begin{equation}
H_l=\frac{X_l-\bar{X}}{S};\hspace{0.1cm} l=1,\ldots,L 
\end{equation}\]</span></p>
<p style="text-align:justify;">
Which has the same distribution for all <span class="math inline">\(l = 1, \ldots ,L\)</span>. The critical value is:
</p>
<p><span class="math display">\[\begin{equation}
h_{l;1-\frac{\alpha}{2}}=\frac{(L-1)t_{L-2;1-\frac{\alpha}{2}}}{\sqrt{L\left(t_{L-2;1-\frac{\alpha}{2}}^2+L-2\right)}};\hspace{0.1cm} l=1,\ldots,L 
\end{equation}\]</span></p>
<p style="text-align:justify;">
Whereby <span class="math inline">\(t_{L-2;1-\frac{\alpha}{2}}\)</span> is the <span class="math inline">\(\left(1-\frac{\alpha}{2}\right)\)</span> quantile of the <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(v = L−2\)</span> degrees of freedom.
</p>
<p style="text-align:justify;">
For the case defined by <span class="math inline">\(L\)</span> laboratories that obtain n replicates each one, the <span class="math inline">\(h\)</span> statistic is defined by:
</p>
<p><span class="math display">\[\begin{equation}
h_{l}=\frac{d_l}{S_{\bar{x}}}=\frac{\bar{x}_l-m}{\sqrt{\displaystyle\sum_{l=1}^L \frac{(\bar{x}_l-m)^2}{L-1}}};l=1,\ldots,L
\end{equation}\]</span></p>
<p style="text-align:justify;">
Whereby <span class="math inline">\(\bar{x}_l\)</span> is the mean of the n results of each laboratory, and <span class="math inline">\(m\)</span> is the global mean of the results of the <span class="math inline">\(L\)</span> laboratories.
</p>
<p>
</p>
<p style="text-align:justify;">
A laboratory is detected as inconsistent when the value of the statistic <span class="math inline">\(h_l\)</span> is greater than the critical value, i.e. when <span class="math inline">\(h_l\geq h_{l;1-\frac{\alpha}{2}}\)</span>.
</p>
<p style="text-align:justify;">
On the other hand, if we want to determine if the observation <span class="math inline">\(X_{max} = max(X_1,\ldots,X_n)\)</span> is an outlier, the Grubbs test is used. The statistic corresponding to this test is defined by the following expression:
</p>
<p><span class="math display">\[\begin{equation}
G=\displaystyle\max_{i=1,\ldots,n}H_i=\displaystyle\max_{i=1,\ldots,n} \frac{X_i-\bar{X}}{S}=\frac{X_{max}-\bar{X}}{S}
\end{equation}\]</span></p>
<p style="text-align:justify;">
If we want to determine if the smallest observation <span class="math inline">\(X_min = min(X_1,\ldots,Xn)\)</span> is an outlier, the test statistic is:
</p>
<p><span class="math display">\[\begin{equation}
G=\displaystyle\max_{i=1,\ldots,n}-H_i=\displaystyle\max_{i=1,\ldots,n} \frac{X_i-\bar{X}}{S}=\frac{X_{min}-\bar{X}}{S}
\end{equation}\]</span></p>
<p>The critical value for this test is defined by:</p>
<p><span class="math display">\[\begin{equation}
g_{n;1-\alpha}\approx \frac{(n-1)t_{n-2;1-\frac{\alpha}{2}}}{\sqrt{n\left(n-2+t_{n-2;1-\frac{\alpha}{2}^2}\right)}}
\end{equation}\]</span></p>
<p style="text-align:justify;">
For the special problem where there are <span class="math inline">\(L\)</span> laboratories and n replicates obtained for each one, the statistic <span class="math inline">\(g_{L;1-\alpha}\)</span>is defined. In this case, the observations must be replaced by the means of the results corresponding to each laboratory, whereas the mean of the observations is also replaced by the global mean obtained as the mean of laboratories mean.
</p>
<p style="text-align:justify;">
If a laboratory is identified as an outlier, after applying the <span class="math inline">\(h\)</span> statistic and the Grubbs test to different levels within a laboratory, this is an evidence of the presence of a laboratory high bias (due to a high systematic error in calibration, or errors in the equations when the results were computed).
</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="mandels-k-statistic-and-cochran-test">
<span style="color: #1CA666;">2.1.2. Mandel’s k statistic and Cochran test</span><a class="anchor" aria-label="anchor" href="#mandels-k-statistic-and-cochran-test"></a>
</h4>
<p style="text-align:justify;">
Let <span class="math inline">\((S_1^2, S_2^2,\ldots, S_L^2)\)</span> be a series of <span class="math inline">\(L\)</span> sample variances with each one based on <span class="math inline">\(n\)</span> observed values. Under the assumption that the observed values <span class="math inline">\(X_{ij}: j=1,2,\ldots,L; ~ i=1,2,\ldots,n\)</span> are realizations of random variables <span class="math inline">\(X_{ij}\)</span> identically and independently distributed according to a normal distribution <span class="math inline">\(N(\mu_i, \sigma^2)\)</span> for each <span class="math inline">\(j\)</span>, the sample variances <span class="math inline">\(S_j^2: j = 1,\ldots,L\)</span> divided by their expectation <span class="math inline">\(\sigma^2\)</span> follow a <span class="math inline">\(\chi^2/v\)</span> with <span class="math inline">\(v = n − 1\)</span> degrees of freedom. Mandel’s k statistic is defined by:
</p>
<p><span class="math display">\[\begin{equation}
k_l=\frac{S_l}{\sqrt{\bar{S}^2}}: j=1,2,\ldots,L
\end{equation}\]</span></p>
<p>with</p>
<p><span class="math display">\[\begin{equation}
\bar{S}^2=\frac{\displaystyle\sum_{l=1}^L S_l^2}{L}
\end{equation}\]</span></p>
<p style="text-align:justify;">
with the same distribution for all <span class="math inline">\(l = 1,\ldots,L\)</span>. The critical value is:
</p>
<p><span class="math display">\[\begin{equation}
k_{l,n;1-\alpha}=\sqrt{\frac{L}{\left(1+\frac{L-1}{F_{v_1,v_2;\alpha}}\right)}}
\end{equation}\]</span></p>
<p style="text-align:justify;">
Where <span class="math inline">\(F_{v_1,v_2;\alpha}\)</span> is the <span class="math inline">\(\alpha\)</span>-quantile of the distribution <span class="math inline">\(F\)</span> with <span class="math inline">\(v_1 = (L − 1)(n − 1)\)</span> and <span class="math inline">\(v_2 = n − 1\)</span> degrees of freedom.
</p>
<p style="text-align:justify;">
When <span class="math inline">\(L\)</span> laboratories with <span class="math inline">\(n\)</span> replicates are studied, the <span class="math inline">\(k\)</span> statistic is defined by:
</p>
<p><span class="math display">\[\begin{equation}
k_{l}=\frac{S_l}{S_r}=\frac{\sqrt{\displaystyle\sum_{l=1}^L \frac{(x_l-\bar{x})^2}{n-1}}}{\sqrt{\frac{\displaystyle\sum_{l=1}^L S_l}{L}}}
\end{equation}\]</span></p>
<p style="text-align:justify;">
Where <span class="math inline">\(S_l\)</span> is the standard deviation of the replicates of each laboratory for a given material. A laboratory is detected as inconsistent when the value of the statistic <span class="math inline">\(k\)</span> is greater than the critical value, this is, <span class="math inline">\(k_l \geq k_{l,n;1−\alpha}\)</span>.
</p>
<p style="text-align:justify;">
On the other hand, to determine if the highest variance <span class="math inline">\(S_{max}^2=\max(S_1^2,S_2^2,\ldots,S_L^2)\)</span> is an outlier, we used the Cochran test:
</p>
<p><span class="math display">\[\begin{equation}
C=\frac{S_{max}^2}{\displaystyle\sum_{j=1}^L S_j^2}=\frac{1}{L}\max_{i=1,\ldots,L}\frac{S_j^2}{\bar{S}^2}
\end{equation}\]</span></p>
<p style="text-align:justify;">
For this test, the critical value, follows the expression:
</p>
<p><span class="math display">\[\begin{equation}
c_{l,n:1-\alpha}\approx\frac{1}{\left(1-(L-1)F_{v_1,v_2;\frac{\alpha}{L}}\right)}
\end{equation}\]</span></p>
<p style="text-align:justify;">
Where <span class="math inline">\(F_{v_1,v_2;\frac{\alpha}{L}}\)</span> is the <span class="math inline">\(\frac{\alpha}{L}\)</span>-quantil of the <span class="math inline">\(F\)</span> distribution with <span class="math inline">\(v_1 = (L − 1)(n − 1)\)</span> and <span class="math inline">\(v_2 = n − 1\)</span> degrees of freedom.
</p>
<p style="text-align:justify;">
The Cochran test is a one tail test for outliers, because it only evaluates the highest value in a series of variances. If a laboratory is detected as an outlier, using the k statistic or with the Cochran test, this indicates that the variance within the laboratory is high (due to lack of familiarity with the analytical method, differences of appreciation among operators, inadequate equipment, equipment in poor state, or careless execution), in which case, the total of results collected by this laboratory, should be rejected and taken out of the study.
</p>
<p style="text-align:justify;">
The detection of inconsistent laboratories must be repeated until laboratories stop reporting outliers. However, the consistency tests should be used with caution, because if this process is carried out in excess, could lead to false outlier identification.
</p>
</div>
</div>
<div class="section level3">
<h3 id="ils-glucose-study">
<span style="color: #1CA666;">2.2. ILS: Glucose study</span><a class="anchor" aria-label="anchor" href="#ils-glucose-study"></a>
</h3>
<p style="text-align:justify;">
In this section, we will use the qcdata and qcstat objects <code><a href="../reference/lab.qcdata.html">lab.qcdata()</a></code> and <code><a href="../reference/lab.qcs.html">lab.qcs()</a></code> created in subsection 2.1 from the Glucose dataset. First, an analysis of the variability for each laboratory will be performed. For this purpose, the k statistic (<code><a href="../reference/k.qcs.html">k.qcs()</a></code>) and the Cocharn test (<code><a href="../reference/cochran.test.html">cochran.test()</a></code>) will be used to identify if there is any laboratory with non-consistent results. Subsequently, the h statistic (<code><a href="../reference/h.qcs.html">h.qcs()</a></code>) and the Grubbs test (<code><a href="../reference/grubbs.test.html">grubbs.test()</a></code>) will be used to perform an analysis to evaluate inter-laboratory variability.
</p>
<p style="text-align:justify;">
The following statements creates a <code><a href="../reference/k.qcs.html">k.qcs()</a></code> object and the corresponding graph for the <span class="math inline">\(k\)</span> statistics for each laboratory and material (see Figure 5).
</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mflores72000/ILS/" class="external-link">ILS</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span>
<span><span class="co">#&gt; Loading required package: multcomp</span></span>
<span><span class="co">#&gt; Loading required package: mvtnorm</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="co">#&gt; Loading required package: TH.data</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'TH.data'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MASS':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     geyser</span></span>
<span><span class="co">#&gt; Loading required package: depthTools</span></span>
<span><span class="co">#&gt; Loading required package: fda.usc</span></span>
<span><span class="co">#&gt; Loading required package: fda</span></span>
<span><span class="co">#&gt; Loading required package: splines</span></span>
<span><span class="co">#&gt; Loading required package: fds</span></span>
<span><span class="co">#&gt; Loading required package: rainbow</span></span>
<span><span class="co">#&gt; Loading required package: pcaPP</span></span>
<span><span class="co">#&gt; Loading required package: RCurl</span></span>
<span><span class="co">#&gt; Loading required package: deSolve</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fda'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:lattice':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     melanoma</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:graphics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     matplot</span></span>
<span><span class="co">#&gt; Loading required package: mgcv</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; This is mgcv 1.8-40. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;  Functional Data Analysis and Utilities for Statistical Computing</span></span>
<span><span class="co">#&gt;  fda.usc version 2.0.2 (built on 2020-02-17) is now loaded</span></span>
<span><span class="co">#&gt;  fda.usc is running sequentially usign foreach package</span></span>
<span><span class="co">#&gt;  Please, execute ops.fda.usc() once to run in local parallel mode</span></span>
<span><span class="co">#&gt;  Deprecated functions: min.basis, min.np, anova.hetero, anova.onefactor, anova.RPm</span></span>
<span><span class="co">#&gt;  New functions: optim.basis, optim.np, fanova.hetero, fanova.onefactor, fanova.RPm</span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Package ILS: Interlaboratory Study </span></span>
<span><span class="co">#&gt;  version 0.2 (built on 2018-03-06).</span></span>
<span><span class="co">#&gt;  Copyright Miguel A. Flores Sanchez 2016.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ILS'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:nlme':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Glucose</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Glucose"</span>, package <span class="op">=</span> <span class="st">"ILS"</span><span class="op">)</span></span>
<span><span class="va">qcdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lab.qcdata.html">lab.qcdata</a></span><span class="op">(</span><span class="va">Glucose</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/k.qcs.html">k.qcs</a></span><span class="op">(</span><span class="va">qcdata</span>, alpha <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span></code></pre></div>
<p><img src="univariantes_files/figure-html/unnamed-chunk-3-1.png" width="100%" height="70%" style="display: block; margin: auto;"></p>
<p style="text-align:justify;">
</p>
<center>
<strong>Figure 5</strong>: Values of Mandel’s <span class="math inline">\(k\)</span>, classified by laboratory and material, corresponding to glucose measurements in blood available in the Glucose database.
</center>

<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of laboratories:  8</span></span>
<span><span class="co">#&gt; Number of materials:  5</span></span>
<span><span class="co">#&gt; Number of replicate:  3</span></span>
<span><span class="co">#&gt; Critical value:  2.06084</span></span>
<span><span class="co">#&gt; Beyond limits of control: </span></span>
<span><span class="co">#&gt;         A    B     C    D     E</span></span>
<span><span class="co">#&gt; Lab1 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab2 TRUE TRUE  TRUE TRUE FALSE</span></span>
<span><span class="co">#&gt; Lab3 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab4 TRUE TRUE FALSE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab5 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab6 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab7 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="co">#&gt; Lab8 TRUE TRUE  TRUE TRUE  TRUE</span></span>
<span><span class="fu"><a href="../reference/cochran.test.html">cochran.test</a></span><span class="op">(</span><span class="va">qcdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test Cochran </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Critical value: 0.5156875 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Alpha test: 0.00625 </span></span>
<span><span class="co">#&gt;   Smax Material          C p.value</span></span>
<span><span class="co">#&gt; 1 Lab4        A 0.20033869  0.0231</span></span>
<span><span class="co">#&gt; 2 Lab4        B 0.15447962  0.0102</span></span>
<span><span class="co">#&gt; 3 Lab4        C 0.10935197  0.0029</span></span>
<span><span class="co">#&gt; 4 Lab2        D 0.08493741  0.0010</span></span>
<span><span class="co">#&gt; 5 Lab2        E 0.07416440  0.0005</span></span></code></pre></div>
<p style="text-align:justify;">
In Figure( 5), the discontinuous line represents the critical value obtained at a significance level of 0.005. Hence, outliers were detected for the material 5 of laboratory 2, and for material 3 of laboratory 4, since the corresponding values of the <span class="math inline">\(k\)</span> statistics were greater than the critical value obtained for <span class="math inline">\(L = 8, n = 15\)</span> and <span class="math inline">\(\alpha = 0.005\)</span> (following the ASTM standard).
</p>
<p>The <code><a href="../reference/k.qcs.html">k.qcs()</a></code> function computes the following objects:</p>
<ul>
<li><p><span class="math inline">\(k\)</span>: The <span class="math inline">\(k\)</span> statistic for each laboratory and material.</p></li>
<li><p><span class="math inline">\(k\)</span>.critical: The critical value for the <span class="math inline">\(\alpha\)</span> defined in the function <code><a href="../reference/k.qcs.html">k.qcs()</a></code>.</p></li>
<li><p><code>violations</code>: Matrix of <span class="math inline">\(L\times R\)</span> dimension (number of laboratories by number of materials).</p></li>
</ul>
<p style="text-align:justify;">
The matrix of <code>violations</code> contains logical values resulting from comparisons between the critical value and the <span class="math inline">\(k\)</span> value. If this comparison is FALSE, the laboratory reports outlying results at a certain level, this is, the critical value is less than the statistic value. In this example, the critical value is 2.06.
</p>
<p style="text-align:justify;">
We performed the Cochran test using the <code><a href="../reference/cochran.test.html">cochran.test()</a></code> function. In this case study, with the maximum variance for each material, no laboratory was considered inconsistent, since the critical value was 0.52 and the p-values in each material did not exceed the 5% significance level.
</p>
<p style="text-align:justify;">
We proceeded to use the functions <code><a href="../reference/h.qcs.html">h.qcs()</a></code> and <code>plot(h)</code> to estimate and plot the h statistics for each laboratory and material. Subsequently, the Grubbs test was applied. The critical value was 2.15, therefore, from this result it can be seen in figure 5 that laboratories 4, 7 and 8 presented non-consistent results at a significance level of <span class="math inline">\(\alpha\)</span> = 0.005. Moreover, laboratories with very extreme results were detected by using the Grubbs test, i.e. laboratories defined by very large and very small results (glucose content).
</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mflores72000/ILS/" class="external-link">ILS</a></span><span class="op">)</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h.qcs.html">h.qcs</a></span><span class="op">(</span><span class="va">qcdata</span>, alpha <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p><img src="univariantes_files/figure-html/unnamed-chunk-5-1.png" width="100%" height="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of laboratories:  8</span></span>
<span><span class="co">#&gt; Number of materials:  5</span></span>
<span><span class="co">#&gt; Number of replicate:  3</span></span>
<span><span class="co">#&gt; Critical value:  2.152492</span></span>
<span><span class="co">#&gt; Beyond limits of control: </span></span>
<span><span class="co">#&gt;         A    B     C     D    E</span></span>
<span><span class="co">#&gt; Lab1 TRUE TRUE  TRUE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab2 TRUE TRUE  TRUE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab3 TRUE TRUE  TRUE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab4 TRUE TRUE FALSE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab5 TRUE TRUE  TRUE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab6 TRUE TRUE  TRUE  TRUE TRUE</span></span>
<span><span class="co">#&gt; Lab7 TRUE TRUE  TRUE FALSE TRUE</span></span>
<span><span class="co">#&gt; Lab8 TRUE TRUE  TRUE FALSE TRUE</span></span>
<span><span class="fu"><a href="../reference/cochran.test.html">cochran.test</a></span><span class="op">(</span><span class="va">qcdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test Cochran </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Critical value: 0.5156875 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Alpha test: 0.00625 </span></span>
<span><span class="co">#&gt;   Smax Material          C p.value</span></span>
<span><span class="co">#&gt; 1 Lab4        A 0.20033869  0.0231</span></span>
<span><span class="co">#&gt; 2 Lab4        B 0.15447962  0.0102</span></span>
<span><span class="co">#&gt; 3 Lab4        C 0.10935197  0.0029</span></span>
<span><span class="co">#&gt; 4 Lab2        D 0.08493741  0.0010</span></span>
<span><span class="co">#&gt; 5 Lab2        E 0.07416440  0.0005</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://scholar.google.es/citations?user=UOqAIw0AAAAJ&amp;hl" class="external-link">Miguel Flores</a>, <a href="https://scholar.google.es/citations?user=X3GWf_cAAAAJ&amp;hl" class="external-link">Ruben Fernandez</a>, <a href="https://scholar.google.es/citations?user=cYugRuUAAAAJ&amp;hl" class="external-link">Salvador Naya</a>, <a href="https://scholar.google.es/citations?user=rbBIGUkAAAAJ&amp;hl" class="external-link">Javier Tarrio-Saavedra</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
